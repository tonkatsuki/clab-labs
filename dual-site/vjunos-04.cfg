interfaces {
    ge-0/0/0 {
        flexible-vlan-tagging;
        mtu 9216;
        unit 16 {
            description ibgp-for-sites;
            family bridge {
                interface-mode trunk;
                vlan-id 16;
            }
        }
    }
    ge-0/0/2 {
        flexible-vlan-tagging;
        mtu 9216;
        unit 0 {
            vlan-id 0;
            family inet {
                address 10.4.1.2/24;
            }
        }
        unit 16 {
            description ibgp-for-sites;
            family bridge {
                interface-mode trunk;
                vlan-id 16;
            }
        }
    }
    irb {
        unit 16 {
            description irb16-bvi-ibgp;
            family inet {
                mtu 9000;
                address 10.6.5.11/24;
            }
        }
    }
    lo0 {
        unit 0 {
            family inet {
                address 10.101.1.1/32;
                address 172.17.7.1/24;
            }
        }
    }
}
policy-options {
    policy-statement export-ibgp-corp {
        term reject-default-v4 {
            from {
                route-filter 0.0.0.0/0 exact;
            }
            then reject;
        }
        term allow-172-v4 {
            from interface lo0.0;
            then accept;
        }
        then {
            next-hop self;
        }
    }
    policy-statement export-internet-ebgp-v4 {
        term export-172 {
            from {
                protocol direct;
                interface lo0.0;
            }
            then accept;
        }
        term REJECT-OTHER {
            then reject;
        }
    }
    policy-statement import-internet-ebgp-v4 {
        term reject-default-v4 {
            from {
                route-filter 0.0.0.0/0 exact;
            }
            then reject;
        }
        term reject-small-prefixes-v4 {
            from {
                route-filter 0.0.0.0/0 prefix-length-range /25-/32;
            }
            then reject;
        }
        then accept;
    }
}
routing-instances {
    mgmt_junos {
        routing-options {
            static {
                route 0.0.0.0/0 next-hop 10.0.0.2;
            }
        }
    }
}
routing-options {
    router-id 10.101.1.1;
    autonomous-system 64666;
    static {
        route 10.100.1.1/32 next-hop 10.4.1.1;
    }
}
protocols {
    bgp {
        group intrasite-bgp {
            type internal;
            local-address 10.101.1.1;
            family inet {
                unicast;
            }
            export export-ibgp-corp;
            neighbor 10.100.1.1;
        }
        group internet-ebgp {
            type external;
            import import-internet-ebgp-v4;
            export export-internet-ebgp-v4;
            peer-as 3400;
        }
        mtu-discovery;
        log-updown;
        bgp-error-tolerance {
            malformed-update-log-interval 10;
            malformed-route-limit 1000;
        }
        remove-private;
    }
    lldp {
        interface all;
    }
}
bridge-domains {
    vlan16-bvi-ibgp {
        domain-type bridge;
        vlan-id 16;
        routing-interface irb.16;
    }
}
